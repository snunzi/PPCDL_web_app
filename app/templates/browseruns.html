{% extends "base.html" %}


{% block app_content %}
<div id="main" class="container">
    <h2>Runs</h2>
    <p></p><p>
    <h4><a href="{{ url_for('main.run', username=current_user.username) }}"> + Add New Run </a></h4>
    <form method="POST">
    <table id="data" class="table table-striped">
      <thead>
        <tr>
          <th></th>
          <th>Run</th>
          <th>Description</th>
          <th>Date</th>
          <th>QC</th>
          <th>Analysis</th>
          <th>Samples</th>
          <th>Options</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <button type="submit">Analyze</button>
</div>

{% endblock %}


{% block scripts %}
  {{super()}}
  <script>
    $(document).ready(function () {
      $('#data').DataTable({
        ajax: "{{ url_for('main.rundata') }}",
        serverSide: true,
        columns: [
          {data: 'id', orderable: false},
          {data: 'run_id'},
          {data: 'description'},
          {data: 'timestamp'},
          {data: 'qc_output', orderable: false},
          {data: 'summary_output', orderable: false},
          {data: 'run_id', orderable: false},
          {data: 'run_id', orderable: false}
        ],
        "columnDefs": [
          {
            "targets": -2,
            "data": data[1],
            "render": function (data, type, row, meta) {
              let url = "{{ url_for('main.runsamples', username=current_user.username, runname='DATA') }}".replace('DATA', data);
              return '<a href="' + url + '">'+'View'+'</a>';
            }
          },
          {
            "targets": -5,
            "render": function (data, type, row, meta) {
              var tdat = data.split(' ');
              return tdat[0];
            }
          },
          {
            "targets": -1,
            "data": data[1],
            "render": function (data, type, row, meta) {
              let durl = "{{ url_for('main.rundelete', username=current_user.username, runname='DATA') }}".replace('DATA', data);
              return '<a class="btn btn-info btn-sm" onclick="return DeleteFunction()" href="' + durl  + '">' + 'Delete'+'</a><a class="btn btn-info btn-sm" onclick="return DeleteFunction()" href="' + durl  + '">' + 'Edit'+'</a>';
            }
          },
          {
            "targets": -3,
            "data": data[1],
            "render": function (data, type, row, meta) {
              if ( data === null ) {
                return '';
              }
              else {
                let url = "{{ url_for('main.runanalysis', username=current_user.username, runname='DATA') }}".replace('DATA', row.run_id);
                return '<a href="' + url + '">'+'View'+'</a>';
              }
            }
          },
          {
            "targets": -4,
            "data": data[1],
            "render": function (data, type, row, meta) {
              if ( data === null ) {
                return '';
              }
              else {
                let url = "{{ url_for('main.runqc', username=current_user.username, runname='DATA') }}".replace('DATA', row.run_id);
                return '<a href="' + url + '">'+'View'+'</a>';
              }
            }
          },
          {
            "targets": 0,
            "data": data[0],
            "render": function (data, type, row, meta) {
              return '<input type="checkbox" name="chkbox" onclick="onlyOne(this)" value=' + data + '>'+''+'</a>';
        } }
        ],
          order: [[ 1, 'asc' ]]
      });
    });
  </script>
  <script>
    function DeleteFunction() {
        if (confirm('Are you sure you want to delete this run--this will also delete uploaded raw reads?'))
            return true;
        else {
            return false;
        }
    }
  </script>
  <script>
    function onlyOne(checkbox) {
      var checkboxes = document.getElementsByName('chkbox')
      checkboxes.forEach((item) => {
          if (item !== checkbox) item.checked = false
      })
    }
  </script>
{% endblock %}
